<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Komik Interaktif Pecahan</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  /* Custom Utilities untuk efek 3D yang mulus */
  .preserve-3d {
    transform-style: preserve-3d;
  }
  .backface-hidden {
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }
  .rotate-y-180 {
    transform: rotateY(-180deg);
  }
  /* Titik putar di kiri seperti engsel buku */
  .origin-left-book {
    transform-origin: left center;
  }
</style>
</head>

<body class="m-0 text-center font-sans bg-gray-100 min-h-screen flex flex-col items-center justify-center overflow-hidden">

<div id="welcome" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-50">
  <h1 class="text-4xl font-bold text-blue-600 mb-4">üëã Selamat Datang</h1>
  <p class="text-xl text-gray-600 mb-8">Komik Interaktif<br>Penjumlahan Pecahan</p>
  <button onclick="mulai()" class="px-8 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition transform hover:scale-105">
    üìñ Mulai Baca Komik
  </button>
</div>

<div id="nav" class="hidden fixed top-4 z-40 w-full flex justify-center gap-4">
  <button onclick="prev()" class="px-6 py-2 bg-white text-gray-700 font-bold rounded-full shadow-md hover:bg-gray-100 border border-gray-200">
    ‚¨ÖÔ∏è Prev
  </button>
  <button onclick="next()" class="px-6 py-2 bg-blue-600 text-white font-bold rounded-full shadow-md hover:bg-blue-700">
    Next ‚û°Ô∏è
  </button>
</div>

<div id="book" class="hidden relative w-full max-w-4xl h-[80vh] perspective-[1500px] mt-12">
  
  <div class="relative w-full h-full">

    <div class="absolute inset-0 bg-white rounded-r-lg shadow-xl border-r border-gray-300 flex items-center justify-center overflow-hidden">
        <img id="nextPage" class="w-full h-full object-contain">
        <iframe id="nextGgb" class="w-full h-full border-0 hidden"></iframe>
    </div>

    <div id="flipContainer" class="absolute inset-0 bg-white rounded-r-lg shadow-2xl border-r border-gray-300 origin-left-book preserve-3d transition-transform duration-700 ease-in-out z-20 flex items-center justify-center overflow-hidden">
        <img id="currentPage" class="w-full h-full object-contain backface-hidden bg-white">
        <iframe id="currentGgb" class="w-full h-full border-0 hidden backface-hidden bg-white"></iframe>
    </div>

  </div>
</div>

<div id="profil" class="hidden absolute inset-0 bg-white z-50 flex flex-col items-center justify-center p-8">
  <div class="max-w-2xl text-center">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">üë©‚Äçüè´ Profil Pembuat</h2>
    <div class="bg-blue-50 p-6 rounded-xl shadow-inner mb-6 text-left inline-block">
        <p class="mb-2"><b>Nama:</b> Ni Luh Putu Sri Laksmi</p>
        <p class="mb-2"><b>NIM:</b> 2313011006</p>
        <p><b>Program Studi:</b> Pendidikan Matematika</p>
    </div>

    <h3 class="text-xl font-bold text-gray-700 mb-3">üôè Special Thanks</h3>
    <p class="text-gray-600 mb-8 leading-relaxed">
      Dosen Pembimbing: Prof. Dr. I Made Candiasa, M.I.Kom<br>
      Teman-Teman Kelas 5 Matematika Multimedia: Ratih, Rangga, Bertha<br>
      Orang Tua & Keluarga<br>
      Semua pihak yang mendukung
    </p>

    <button onclick="restart()" class="px-8 py-3 bg-green-500 text-white font-bold rounded-full shadow-lg hover:bg-green-600 transition">
      üîÅ Baca Ulang Komik
    </button>
  </div>
</div>

<script>
let step = 0;
const total = 17;

// Pastikan path gambar ini benar sesuai folder Anda
const pages = {
  1:"img/1.png", 2:"img/2.png", 3:"img/3.png",
  5:"img/4.png", 6:"img/5.png", 7:"img/6.png", 8:"img/7.png",
  10:"img/8.png",11:"img/9.png",12:"img/10.png",
  14:"img/11.png",15:"img/12.png",16:"img/13.png"
};

const geogebra = {
  4:"https://www.geogebra.org/material/iframe/id/rhj9jtee",
  9:"https://www.geogebra.org/material/iframe/id/qk5ecuje",
  13:"https://www.geogebra.org/material/iframe/id/mz6xhrff"
};

// Referensi Elemen
const welcome = document.getElementById("welcome");
const nav = document.getElementById("nav");
const book = document.getElementById("book");
const profil = document.getElementById("profil");

// Elemen Layer Atas
const flipContainer = document.getElementById("flipContainer");
const currentPage = document.getElementById("currentPage");
const currentGgb = document.getElementById("currentGgb");

// Elemen Layer Bawah
const nextPage = document.getElementById("nextPage");
const nextGgb = document.getElementById("nextGgb");

function mulai(){
  step = 1;
  welcome.style.display="none";
  nav.style.display="flex";
  book.style.display="block";
  updateView(); 
}

function restart(){
    step = 1; 
    profil.style.display='none'; 
    book.style.display='block';
    nav.style.display="flex";
    updateView();
}

function next(){
  if(step < total){
    // Efek Flip hanya jika bukan halaman terakhir
    flip(() => {
        step++;
        updateView();
    });
  } else {
    // Ke halaman profil
    step++;
    updateView();
  }
}

function prev(){
  if(step > 1){
    step--;
    updateView();
  }
}

// Fungsi Utama: Mengatur gambar apa yang muncul di Layer Atas & Bawah
function updateView(){
  // Cek jika sudah selesai
  if(step > total){ // Changed to > total to catch step 17
    book.style.display="none";
    nav.style.display="none";
    profil.style.display="flex";
    return;
  }

  // 1. SET LAYER ATAS (Halaman Sekarang)
  setLayerContent(step, currentPage, currentGgb);

  // 2. SET LAYER BAWAH (Halaman Berikutnya / Intip)
  // Jika ada halaman berikutnya, kita muat gambarnya di layer bawah
  if (step < total) {
      setLayerContent(step + 1, nextPage, nextGgb);
  } else {
      // Jika halaman terakhir, kosongkan layer bawah
      nextPage.src = "";
      nextPage.style.display = "none";
      nextGgb.style.display = "none";
  }
}

// Helper function untuk mengisi gambar/iframe ke elemen
function setLayerContent(pageNumber, imgEl, iframeEl) {
    if(geogebra[pageNumber]){
        imgEl.style.display = "none";
        iframeEl.style.display = "block";
        // Hanya set src jika berbeda agar tidak reload terus
        if(iframeEl.src !== geogebra[pageNumber]) {
            iframeEl.src = geogebra[pageNumber];
        }
    } else {
        iframeEl.style.display = "none";
        imgEl.style.display = "block";
        if (pages[pageNumber]) {
            imgEl.src = pages[pageNumber];
        } else {
            // Fallback jika gambar tidak ada di list
            imgEl.src = "";
        }
    }
}

function flip(done){
  // 1. Tambahkan class rotasi ke container layer atas
  flipContainer.classList.add("rotate-y-180");

  // 2. Tunggu animasi selesai (700ms sesuai duration di CSS)
  setTimeout(()=>{
    // Jalankan logika perpindahan step
    done();
    
    // 3. Matikan animasi (hapus transition class sementara) agar reset posisi instan
    flipContainer.classList.remove("transition-transform", "duration-700");
    flipContainer.classList.remove("rotate-y-180");

    // 4. Nyalakan lagi transition class setelah jeda sangat singkat
    // Ini trik agar mata tidak melihat proses reset
    setTimeout(() => {
        flipContainer.classList.add("transition-transform", "duration-700");
    }, 50);
    
  }, 700);
}
</script>

</body>
</html>